'use strict';

var _get = require('babel-runtime/helpers/get')['default'];

var _inherits = require('babel-runtime/helpers/inherits')['default'];

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

Object.defineProperty(exports, '__esModule', {
    value: true
});

var _helpersConstants = require('../helpers/constants');

var ErrorHandler = (function (_Error) {
    _inherits(ErrorHandler, _Error);

    function ErrorHandler(type, msg) {
        _classCallCheck(this, ErrorHandler);

        _get(Object.getPrototypeOf(ErrorHandler.prototype), 'constructor', this).call(this);
        Error.captureStackTrace(this, this.constructor);

        if (typeof msg === 'number') {
            // if ID is not known error throw UnknownError
            if (!_helpersConstants.ERROR_CODES[msg]) {
                msg = 13;
            }

            this.type = _helpersConstants.ERROR_CODES[msg].id;
            this.message = _helpersConstants.ERROR_CODES[msg].message;
        } else if (arguments.length === 2) {
            this.message = msg;
            this.type = type;
        } else if (arguments.length === 1) {
            this.type = 'WebdriverIOError';
            this.message = type;
        }

        if (typeof this.message === 'object') {
            var seleniumStack = this.message;

            if (seleniumStack.message && seleniumStack.type && seleniumStack.status) {
                if (seleniumStack.orgStatusMessage && seleniumStack.orgStatusMessage.match(/"errorMessage":"NoSuchElement"/)) {
                    seleniumStack.type = 'NoSuchElement';
                    seleniumStack.status = 7;
                    seleniumStack.message = _helpersConstants.ERROR_CODES['7'].message;
                }

                this.message = seleniumStack.message + ' (' + seleniumStack.type + ':' + seleniumStack.status + ')';
            }

            if (seleniumStack.orgStatusMessage) {
                var reqPos = seleniumStack.orgStatusMessage.indexOf(',"request"');
                var problem = '';

                if (reqPos > 0) {
                    problem = JSON.parse(seleniumStack.orgStatusMessage.slice(0, reqPos) + '}').errorMessage;
                } else {
                    problem = seleniumStack.orgStatusMessage;
                }

                if (problem.indexOf('No enum constant org.openqa.selenium.Platform') > -1) {
                    problem = 'The Selenium backend you\'ve chosen doesn\'t support the desired platform (' + problem.slice(46) + ')';
                }

                // truncate errorMessage
                if (problem.indexOf('(Session info:') > -1) {
                    problem = problem.slice(0, problem.indexOf('(Session info:')).replace(/\n/g, '').trim();
                }

                // make assumption based on experience on certain error messages
                if (problem.indexOf('unknown error: path is not absolute') !== -1) {
                    problem = 'You are trying to set a value to an input field with type="file", use the `uploadFile` command instead (Selenium error: ' + problem + ')';
                }

                this.message = problem;
            }
        }
    }

    /**
     * make stack loggable
     * @return {Object} error log
     */

    _createClass(ErrorHandler, [{
        key: 'toJSON',
        value: function toJSON() {
            return {
                name: this.type,
                message: this.message
            };
        }
    }]);

    return ErrorHandler;
})(Error);

var CommandError = function CommandError(msg) {
    return new ErrorHandler('CommandError', msg);
};
var ProtocolError = function ProtocolError(msg) {
    return new ErrorHandler('ProtocolError', msg);
};
var RuntimeError = function RuntimeError(msg) {
    return new ErrorHandler('RuntimeError', msg);
};

exports.ErrorHandler = ErrorHandler;
exports.CommandError = CommandError;
exports.ProtocolError = ProtocolError;
exports.RuntimeError = RuntimeError;
exports['default'] = ErrorHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi91dGlscy9FcnJvckhhbmRsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Z0NBQTRCLHNCQUFzQjs7SUFFNUMsWUFBWTtjQUFaLFlBQVk7O0FBQ0YsYUFEVixZQUFZLENBQ0QsSUFBSSxFQUFFLEdBQUcsRUFBRTs4QkFEdEIsWUFBWTs7QUFFVixtQ0FGRixZQUFZLDZDQUVIO0FBQ1AsYUFBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUE7O0FBRS9DLFlBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFOztBQUV6QixnQkFBSSxDQUFDLDhCQUFZLEdBQUcsQ0FBQyxFQUFFO0FBQ25CLG1CQUFHLEdBQUcsRUFBRSxDQUFBO2FBQ1g7O0FBRUQsZ0JBQUksQ0FBQyxJQUFJLEdBQUcsOEJBQVksR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFBO0FBQy9CLGdCQUFJLENBQUMsT0FBTyxHQUFHLDhCQUFZLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQTtTQUMxQyxNQUFNLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7QUFDL0IsZ0JBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFBO0FBQ2xCLGdCQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTtTQUNuQixNQUFNLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7QUFDL0IsZ0JBQUksQ0FBQyxJQUFJLEdBQUcsa0JBQWtCLENBQUE7QUFDOUIsZ0JBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO1NBQ3RCOztBQUVELFlBQUksT0FBTyxJQUFJLENBQUMsT0FBTyxLQUFLLFFBQVEsRUFBRTtBQUNsQyxnQkFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQTs7QUFFaEMsZ0JBQUksYUFBYSxDQUFDLE9BQU8sSUFBSSxhQUFhLENBQUMsSUFBSSxJQUFJLGFBQWEsQ0FBQyxNQUFNLEVBQUU7QUFDckUsb0JBQUksYUFBYSxDQUFDLGdCQUFnQixJQUFJLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsZ0NBQWdDLENBQUMsRUFBRTtBQUMxRyxpQ0FBYSxDQUFDLElBQUksR0FBRyxlQUFlLENBQUE7QUFDcEMsaUNBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO0FBQ3hCLGlDQUFhLENBQUMsT0FBTyxHQUFHLDhCQUFZLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQTtpQkFDbkQ7O0FBRUQsb0JBQUksQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDLE9BQU8sR0FBRyxJQUFJLEdBQUcsYUFBYSxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsYUFBYSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUE7YUFDdEc7O0FBRUQsZ0JBQUksYUFBYSxDQUFDLGdCQUFnQixFQUFFO0FBQ2hDLG9CQUFJLE1BQU0sR0FBRyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFBO0FBQ2pFLG9CQUFJLE9BQU8sR0FBRyxFQUFFLENBQUE7O0FBRWhCLG9CQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUU7QUFDWiwyQkFBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsWUFBWSxDQUFBO2lCQUMzRixNQUFNO0FBQ0gsMkJBQU8sR0FBRyxhQUFhLENBQUMsZ0JBQWdCLENBQUE7aUJBQzNDOztBQUVELG9CQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsK0NBQStDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtBQUN2RSwyQkFBTyxHQUFHLDZFQUE2RSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFBO2lCQUNwSDs7O0FBR0Qsb0JBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO0FBQ3hDLDJCQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtpQkFDMUY7OztBQUdELG9CQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMscUNBQXFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtBQUMvRCwyQkFBTyxHQUFHLDBIQUEwSCxHQUFHLE9BQU8sR0FBRyxHQUFHLENBQUE7aUJBQ3ZKOztBQUVELG9CQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQTthQUN6QjtTQUNKO0tBQ0o7Ozs7Ozs7aUJBN0RDLFlBQVk7O2VBbUVQLGtCQUFHO0FBQ04sbUJBQU87QUFDSCxvQkFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO0FBQ2YsdUJBQU8sRUFBRSxJQUFJLENBQUMsT0FBTzthQUN4QixDQUFBO1NBQ0o7OztXQXhFQyxZQUFZO0dBQVMsS0FBSzs7QUEyRWhDLElBQUksWUFBWSxHQUFHLFNBQWYsWUFBWSxDQUFhLEdBQUcsRUFBRTtBQUM5QixXQUFPLElBQUksWUFBWSxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsQ0FBQTtDQUMvQyxDQUFBO0FBQ0QsSUFBSSxhQUFhLEdBQUcsU0FBaEIsYUFBYSxDQUFhLEdBQUcsRUFBRTtBQUMvQixXQUFPLElBQUksWUFBWSxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQTtDQUNoRCxDQUFBO0FBQ0QsSUFBSSxZQUFZLEdBQUcsU0FBZixZQUFZLENBQWEsR0FBRyxFQUFFO0FBQzlCLFdBQU8sSUFBSSxZQUFZLENBQUMsY0FBYyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0NBQy9DLENBQUE7O1FBR0csWUFBWSxHQUFaLFlBQVk7UUFDWixZQUFZLEdBQVosWUFBWTtRQUNaLGFBQWEsR0FBYixhQUFhO1FBQ2IsWUFBWSxHQUFaLFlBQVk7cUJBRUQsWUFBWSIsImZpbGUiOiJFcnJvckhhbmRsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFUlJPUl9DT0RFUyB9IGZyb20gJy4uL2hlbHBlcnMvY29uc3RhbnRzJ1xuXG5jbGFzcyBFcnJvckhhbmRsZXIgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IgKHR5cGUsIG1zZykge1xuICAgICAgICBzdXBlcigpXG4gICAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpXG5cbiAgICAgICAgaWYgKHR5cGVvZiBtc2cgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAvLyBpZiBJRCBpcyBub3Qga25vd24gZXJyb3IgdGhyb3cgVW5rbm93bkVycm9yXG4gICAgICAgICAgICBpZiAoIUVSUk9SX0NPREVTW21zZ10pIHtcbiAgICAgICAgICAgICAgICBtc2cgPSAxM1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnR5cGUgPSBFUlJPUl9DT0RFU1ttc2ddLmlkXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBFUlJPUl9DT0RFU1ttc2ddLm1lc3NhZ2VcbiAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtc2dcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGVcbiAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSAnV2ViZHJpdmVySU9FcnJvcidcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IHR5cGVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5tZXNzYWdlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgbGV0IHNlbGVuaXVtU3RhY2sgPSB0aGlzLm1lc3NhZ2VcblxuICAgICAgICAgICAgaWYgKHNlbGVuaXVtU3RhY2subWVzc2FnZSAmJiBzZWxlbml1bVN0YWNrLnR5cGUgJiYgc2VsZW5pdW1TdGFjay5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZW5pdW1TdGFjay5vcmdTdGF0dXNNZXNzYWdlICYmIHNlbGVuaXVtU3RhY2sub3JnU3RhdHVzTWVzc2FnZS5tYXRjaCgvXCJlcnJvck1lc3NhZ2VcIjpcIk5vU3VjaEVsZW1lbnRcIi8pKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVuaXVtU3RhY2sudHlwZSA9ICdOb1N1Y2hFbGVtZW50J1xuICAgICAgICAgICAgICAgICAgICBzZWxlbml1bVN0YWNrLnN0YXR1cyA9IDdcbiAgICAgICAgICAgICAgICAgICAgc2VsZW5pdW1TdGFjay5tZXNzYWdlID0gRVJST1JfQ09ERVNbJzcnXS5tZXNzYWdlXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gc2VsZW5pdW1TdGFjay5tZXNzYWdlICsgJyAoJyArIHNlbGVuaXVtU3RhY2sudHlwZSArICc6JyArIHNlbGVuaXVtU3RhY2suc3RhdHVzICsgJyknXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWxlbml1bVN0YWNrLm9yZ1N0YXR1c01lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVxUG9zID0gc2VsZW5pdW1TdGFjay5vcmdTdGF0dXNNZXNzYWdlLmluZGV4T2YoJyxcInJlcXVlc3RcIicpXG4gICAgICAgICAgICAgICAgbGV0IHByb2JsZW0gPSAnJ1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlcVBvcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbSA9IEpTT04ucGFyc2Uoc2VsZW5pdW1TdGFjay5vcmdTdGF0dXNNZXNzYWdlLnNsaWNlKDAsIHJlcVBvcykgKyAnfScpLmVycm9yTWVzc2FnZVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW0gPSBzZWxlbml1bVN0YWNrLm9yZ1N0YXR1c01lc3NhZ2VcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocHJvYmxlbS5pbmRleE9mKCdObyBlbnVtIGNvbnN0YW50IG9yZy5vcGVucWEuc2VsZW5pdW0uUGxhdGZvcm0nKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2JsZW0gPSAnVGhlIFNlbGVuaXVtIGJhY2tlbmQgeW91XFwndmUgY2hvc2VuIGRvZXNuXFwndCBzdXBwb3J0IHRoZSBkZXNpcmVkIHBsYXRmb3JtICgnICsgcHJvYmxlbS5zbGljZSg0NikgKyAnKSdcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyB0cnVuY2F0ZSBlcnJvck1lc3NhZ2VcbiAgICAgICAgICAgICAgICBpZiAocHJvYmxlbS5pbmRleE9mKCcoU2Vzc2lvbiBpbmZvOicpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvYmxlbSA9IHByb2JsZW0uc2xpY2UoMCwgcHJvYmxlbS5pbmRleE9mKCcoU2Vzc2lvbiBpbmZvOicpKS5yZXBsYWNlKC9cXG4vZywgJycpLnRyaW0oKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIG1ha2UgYXNzdW1wdGlvbiBiYXNlZCBvbiBleHBlcmllbmNlIG9uIGNlcnRhaW4gZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgICAgICAgICBpZiAocHJvYmxlbS5pbmRleE9mKCd1bmtub3duIGVycm9yOiBwYXRoIGlzIG5vdCBhYnNvbHV0ZScpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9ibGVtID0gJ1lvdSBhcmUgdHJ5aW5nIHRvIHNldCBhIHZhbHVlIHRvIGFuIGlucHV0IGZpZWxkIHdpdGggdHlwZT1cImZpbGVcIiwgdXNlIHRoZSBgdXBsb2FkRmlsZWAgY29tbWFuZCBpbnN0ZWFkIChTZWxlbml1bSBlcnJvcjogJyArIHByb2JsZW0gKyAnKSdcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBwcm9ibGVtXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBtYWtlIHN0YWNrIGxvZ2dhYmxlXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBlcnJvciBsb2dcbiAgICAgKi9cbiAgICB0b0pTT04gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogdGhpcy50eXBlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmxldCBDb21tYW5kRXJyb3IgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgcmV0dXJuIG5ldyBFcnJvckhhbmRsZXIoJ0NvbW1hbmRFcnJvcicsIG1zZylcbn1cbmxldCBQcm90b2NvbEVycm9yID0gZnVuY3Rpb24gKG1zZykge1xuICAgIHJldHVybiBuZXcgRXJyb3JIYW5kbGVyKCdQcm90b2NvbEVycm9yJywgbXNnKVxufVxubGV0IFJ1bnRpbWVFcnJvciA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICByZXR1cm4gbmV3IEVycm9ySGFuZGxlcignUnVudGltZUVycm9yJywgbXNnKVxufVxuXG5leHBvcnQge1xuICAgIEVycm9ySGFuZGxlcixcbiAgICBDb21tYW5kRXJyb3IsXG4gICAgUHJvdG9jb2xFcnJvcixcbiAgICBSdW50aW1lRXJyb3Jcbn1cbmV4cG9ydCBkZWZhdWx0IEVycm9ySGFuZGxlclxuIl19
